<div class="mx-auto md:w-2/3 w-full flex flex-col">
  <div class="mx-auto">
    <%= turbo_frame_tag :building_turbo do %>
      <div class="border border-gray-300 rounded-lg mb-4 p-4">
        <%= render @building %>
      </div>
    <% end %>

    <%= link_to 'Edit this building', edit_building_path(@building), data: { turbo_frame: :building_turbo }, class: 'mt-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium' %>
    <%= link_to 'Back to buildings', buildings_path, class: 'ml-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium' %>
    <%= link_to 'Export XML', export_xml_building_path(@building), class: 'ml-2 rounded-lg py-3 px-5 bg-blue-500 inline-block font-medium', data: { turbo: false } %>
    <div class="inline-block ml-2">
      <%= button_to 'Delete this building', @building, method: :delete, data: { turbo_confirm: 'Are you sure you want to delete this building?' }, class: 'mt-2 rounded-lg py-3 px-5 bg-red-500 text-white font-medium' %>
    </div>
  </div>


  <div class="mt-8 overflow-x-auto">
    <h2 class="text-2xl font-bold mb-4">Defects and Evaluations</h2>

    <%= turbo_frame_tag :defects_evaluations_table do %>
      <table class="min-w-full border-collapse border border-gray-300 shadow-lg">
        <thead class="bg-gray-100">
        <tr>
          <th class="border border-gray-300 p-4 text-left font-semibold">Expert</th>
          <% @defects.each do |defect| %>
            <th class="border border-gray-300 p-4 text-left font-semibold">
              <%= turbo_frame_tag dom_id(defect) do %>
                <%= defect.name %>
              <% end %>
            </th>
          <% end %>
        </tr>
        </thead>
        <tbody>
        <% @experts.each_with_index do |expert, index| %>
          <%= turbo_frame_tag dom_id(expert) do %>
            <tr class="<%= index.even? ? 'bg-white' : 'bg-gray-50' %>">
              <td class="border border-gray-300 p-4">
                <%= turbo_frame_tag dom_id(expert) do %>
                  <%= expert.name %>
                <% end %>
              </td>
              <% @defects.each do |defect| %>
                <td class="border border-gray-300 p-4 text-center">
                  <%= turbo_frame_tag "defect_#{defect.id}_expert_#{expert.id}" do %>
                    <% evaluation = defect.evaluations.find_by(expert: expert) %>
                    <%= evaluation ? evaluation.rating : "-" %>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% end %>
        </tbody>
      </table>
    <% end %>
  </div>

  <%= render 'buildings/defects/defects' %>

  <%= render 'buildings/experts/experts' %>

  <%= render 'buildings/evaluations/evaluations' %>
</div>
